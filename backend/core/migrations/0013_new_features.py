# Generated by Django 4.2 on 2025-12-07 03:57

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone
import uuid


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('core', '0012_category_icon'),
    ]

    operations = [
        migrations.CreateModel(
            name='DeliveryInsurance',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('tier', models.CharField(choices=[('basic', 'Basic (up to KSh 5,000)'), ('standard', 'Standard (up to KSh 20,000)'), ('premium', 'Premium (up to KSh 100,000)')], default='basic', max_length=20)),
                ('declared_value', models.FloatField()),
                ('coverage_amount', models.FloatField()),
                ('premium', models.FloatField()),
                ('item_description', models.TextField()),
                ('item_photos', models.JSONField(default=list)),
                ('status', models.CharField(choices=[('active', 'Active'), ('claimed', 'Claimed'), ('expired', 'Expired')], default='active', max_length=20)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('job', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='insurance', to='core.job')),
            ],
            options={
                'verbose_name_plural': 'Delivery Insurance',
            },
        ),
        migrations.CreateModel(
            name='Recipient',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255)),
                ('phone_number', models.CharField(max_length=50)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('address', models.CharField(blank=True, max_length=255)),
                ('lat', models.FloatField(blank=True, null=True)),
                ('lng', models.FloatField(blank=True, null=True)),
                ('company', models.CharField(blank=True, max_length=255)),
                ('notes', models.TextField(blank=True)),
                ('delivery_count', models.IntegerField(default=0)),
                ('last_delivery', models.DateTimeField(blank=True, null=True)),
                ('is_favorite', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recipients', to='core.customer')),
            ],
            options={
                'ordering': ['-is_favorite', '-delivery_count', '-last_delivery'],
            },
        ),
        migrations.CreateModel(
            name='Referral',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('referred_email', models.EmailField(max_length=254)),
                ('referrer_reward_amount', models.FloatField(default=0)),
                ('referee_reward_amount', models.FloatField(default=0)),
                ('referrer_rewarded', models.BooleanField(default=False)),
                ('referee_rewarded', models.BooleanField(default=False)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('signed_up', 'Signed Up'), ('completed', 'Completed'), ('rewarded', 'Rewarded')], default='pending', max_length=20)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('first_delivery_job', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.job')),
            ],
        ),
        migrations.CreateModel(
            name='Wallet',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('balance', models.FloatField(default=0)),
                ('total_earned', models.FloatField(default=0)),
                ('total_spent', models.FloatField(default=0)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='wallet', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddField(
            model_name='courier',
            name='total_ratings',
            field=models.IntegerField(default=0),
        ),
        migrations.CreateModel(
            name='WalletTransaction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('amount', models.FloatField()),
                ('transaction_type', models.CharField(choices=[('credit', 'Credit'), ('debit', 'Debit')], max_length=10)),
                ('description', models.CharField(blank=True, max_length=255)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('job', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.job')),
                ('referral', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.referral')),
                ('wallet', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to='core.wallet')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TrackingLink',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('short_code', models.CharField(max_length=10, unique=True)),
                ('pin', models.CharField(blank=True, max_length=6)),
                ('view_count', models.IntegerField(default=0)),
                ('last_viewed', models.DateTimeField(blank=True, null=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('job', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tracking_links', to='core.job')),
            ],
        ),
        migrations.CreateModel(
            name='ScheduledDelivery',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255)),
                ('description', models.CharField(max_length=255)),
                ('size', models.CharField(choices=[('small', 'Small (fits in hand)'), ('medium', 'Medium (fits in backpack)'), ('large', 'Large (needs carrier)'), ('extra_large', 'Extra Large (needs vehicle cargo)')], default='medium', max_length=20)),
                ('weight', models.CharField(choices=[('light', 'Light (0-5 kg)'), ('medium', 'Medium (5-15 kg)'), ('heavy', 'Heavy (15-50 kg)'), ('very_heavy', 'Very Heavy (50+ kg)')], default='light', max_length=20)),
                ('vehicle_type', models.CharField(choices=[('boda_boda', 'Boda Boda (Motorcycle)'), ('tuk_tuk', 'TukTuk (Three-Wheeler)'), ('van', 'Van'), ('pickup', 'Pickup Truck'), ('car', 'Car')], default='boda_boda', max_length=20)),
                ('pickup_address', models.CharField(max_length=255)),
                ('pickup_lat', models.FloatField()),
                ('pickup_lng', models.FloatField()),
                ('pickup_name', models.CharField(blank=True, max_length=255)),
                ('pickup_phone', models.CharField(blank=True, max_length=50)),
                ('delivery_address', models.CharField(max_length=255)),
                ('delivery_lat', models.FloatField()),
                ('delivery_lng', models.FloatField()),
                ('delivery_name', models.CharField(blank=True, max_length=255)),
                ('delivery_phone', models.CharField(blank=True, max_length=50)),
                ('frequency', models.CharField(choices=[('once', 'One Time'), ('daily', 'Daily'), ('weekly', 'Weekly'), ('biweekly', 'Every 2 Weeks'), ('monthly', 'Monthly')], default='weekly', max_length=20)),
                ('preferred_time', models.TimeField(blank=True, null=True)),
                ('preferred_day', models.IntegerField(blank=True, null=True)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField(blank=True, null=True)),
                ('next_delivery_date', models.DateTimeField(blank=True, null=True)),
                ('last_delivery_date', models.DateTimeField(blank=True, null=True)),
                ('deliveries_completed', models.IntegerField(default=0)),
                ('max_deliveries', models.IntegerField(blank=True, null=True)),
                ('estimated_price', models.FloatField(default=0)),
                ('auto_pay', models.BooleanField(default=False)),
                ('status', models.CharField(choices=[('active', 'Active'), ('paused', 'Paused'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='active', max_length=20)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.category')),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='scheduled_deliveries', to='core.customer')),
                ('recipient', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.recipient')),
            ],
            options={
                'verbose_name_plural': 'Scheduled Deliveries',
                'ordering': ['next_delivery_date'],
            },
        ),
        migrations.CreateModel(
            name='SavedAddress',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('label', models.CharField(max_length=100)),
                ('address_type', models.CharField(choices=[('home', 'Home'), ('office', 'Office'), ('other', 'Other')], default='other', max_length=20)),
                ('address', models.CharField(max_length=255)),
                ('lat', models.FloatField()),
                ('lng', models.FloatField()),
                ('contact_name', models.CharField(blank=True, max_length=255)),
                ('contact_phone', models.CharField(blank=True, max_length=50)),
                ('building_name', models.CharField(blank=True, max_length=255)),
                ('floor_unit', models.CharField(blank=True, max_length=100)),
                ('landmark', models.CharField(blank=True, max_length=255)),
                ('instructions', models.TextField(blank=True)),
                ('is_default_pickup', models.BooleanField(default=False)),
                ('is_default_delivery', models.BooleanField(default=False)),
                ('use_count', models.IntegerField(default=0)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='saved_addresses', to='core.customer')),
            ],
            options={
                'verbose_name_plural': 'Saved Addresses',
                'ordering': ['-use_count', '-last_used'],
            },
        ),
        migrations.CreateModel(
            name='ReferralCode',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(max_length=20, unique=True)),
                ('referrer_reward', models.FloatField(default=100)),
                ('referee_reward', models.FloatField(default=100)),
                ('total_referrals', models.IntegerField(default=0)),
                ('successful_referrals', models.IntegerField(default=0)),
                ('total_earned', models.FloatField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='referral_code', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddField(
            model_name='referral',
            name='referral_code',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='referrals', to='core.referralcode'),
        ),
        migrations.AddField(
            model_name='referral',
            name='referred_user',
            field=models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='referred_by', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='Rating',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('overall_rating', models.IntegerField()),
                ('speed_rating', models.IntegerField(blank=True, null=True)),
                ('communication_rating', models.IntegerField(blank=True, null=True)),
                ('care_rating', models.IntegerField(blank=True, null=True)),
                ('review', models.TextField(blank=True)),
                ('tags', models.JSONField(default=list)),
                ('courier_response', models.TextField(blank=True)),
                ('response_date', models.DateTimeField(blank=True, null=True)),
                ('tip_amount', models.FloatField(default=0)),
                ('is_public', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('courier', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ratings_received', to='core.courier')),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ratings_given', to='core.customer')),
                ('job', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='rating', to='core.job')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='InsuranceClaim',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('reason', models.CharField(choices=[('damaged', 'Item Damaged'), ('lost', 'Item Lost'), ('stolen', 'Item Stolen')], max_length=20)),
                ('description', models.TextField()),
                ('evidence_photos', models.JSONField(default=list)),
                ('claimed_amount', models.FloatField()),
                ('approved_amount', models.FloatField(blank=True, null=True)),
                ('reviewer_notes', models.TextField(blank=True)),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('payment_reference', models.CharField(blank=True, max_length=100)),
                ('paid_at', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('submitted', 'Submitted'), ('reviewing', 'Under Review'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('paid', 'Paid')], default='submitted', max_length=20)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('insurance', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='claims', to='core.deliveryinsurance')),
            ],
        ),
        migrations.CreateModel(
            name='CashOnDelivery',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('amount_to_collect', models.FloatField()),
                ('amount_collected', models.FloatField(default=0)),
                ('collected_at', models.DateTimeField(blank=True, null=True)),
                ('collection_method', models.CharField(blank=True, max_length=20)),
                ('remittance_method', models.CharField(blank=True, max_length=20)),
                ('remittance_account', models.CharField(blank=True, max_length=100)),
                ('remitted_at', models.DateTimeField(blank=True, null=True)),
                ('remittance_reference', models.CharField(blank=True, max_length=100)),
                ('cod_fee', models.FloatField(default=0)),
                ('notes', models.TextField(blank=True)),
                ('recipient_signature', models.ImageField(blank=True, null=True, upload_to='cod/signatures/')),
                ('status', models.CharField(choices=[('pending', 'Pending Collection'), ('collected', 'Collected'), ('remitted', 'Remitted to Sender'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('job', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='cod', to='core.job')),
            ],
            options={
                'verbose_name': 'Cash on Delivery',
                'verbose_name_plural': 'Cash on Delivery Orders',
            },
        ),
        migrations.CreateModel(
            name='BusinessAccount',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('business_name', models.CharField(max_length=255)),
                ('business_type', models.CharField(blank=True, max_length=100)),
                ('registration_number', models.CharField(blank=True, max_length=100)),
                ('kra_pin', models.CharField(blank=True, max_length=50)),
                ('contact_name', models.CharField(max_length=255)),
                ('contact_email', models.EmailField(max_length=254)),
                ('contact_phone', models.CharField(max_length=50)),
                ('business_address', models.CharField(max_length=255)),
                ('business_lat', models.FloatField(blank=True, null=True)),
                ('business_lng', models.FloatField(blank=True, null=True)),
                ('tier', models.CharField(choices=[('starter', 'Starter (up to 50 deliveries/month)'), ('growth', 'Growth (up to 200 deliveries/month)'), ('enterprise', 'Enterprise (unlimited)')], default='starter', max_length=20)),
                ('discount_percentage', models.FloatField(default=0)),
                ('credit_limit', models.FloatField(default=0)),
                ('current_credit_used', models.FloatField(default=0)),
                ('billing_email', models.EmailField(blank=True, max_length=254)),
                ('payment_terms', models.IntegerField(default=7)),
                ('api_key', models.CharField(blank=True, max_length=64, unique=True)),
                ('webhook_url', models.URLField(blank=True)),
                ('is_verified', models.BooleanField(default=False)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='business_accounts', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Business Accounts',
            },
        ),
    ]
